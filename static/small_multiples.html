<!doctype html>
<html lang="en">
<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">

    <!-- Icon -->
    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="static/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Mapper on Graphs</title>

    <script src="https://d3js.org/d3.v4.min.js"
            integrity="sha384-1EOYqz4UgZkewWm70NbT1JBUXSQpOIS2AaJy6/evZH+lXOrt9ITSJbFctNeyBoIJ"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"
            integrity="sha384-hX5odjoulJel81+3dsnorXlZ7kA46f8qrV+2sBCcEAXaCyEAiRusFRjaefWw2NPp"
            crossorigin="anonymous"></script>

    <script src="js/menu.js"></script>
    <script src="js/graph.js"></script>
    <script src="js/common.js"></script>
    <script src="js/input.js"></script>

</head>
<body>

<script>
	insert_navbar("small_multiples.html");
    insert_page_header();
</script>




<div class="page">
    <div class="sidebar">
        <h2>Mapper on Graphs</h2>
        <form id="parameterForm">
            <div class="container" style="padding: 0;">
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="dataset" style="margin-top: 3px;">Data Set</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="dataset" name="dataset"
                                onchange="change_dataset();"></select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="datafile" style="margin-top: 3px;">Data File</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="datafile" name="datafile"
                                onchange="change_datafile();"></select>
                    </div>
                </div>

                                <div class="d-inline-block align-middle" style="text-align: center;">
                                <script>
                                    let rank_cg = generate_checkbox('rank_filter','Use Rank Filter','load_mog()', 200)
                                    document.write(rank_cg.getHTML())
                                </script>
                                </div>

                                Component Method
                                <div class="d-inline-block align-middle" style="text-align: center;">
                                <script>
                                    let component_rg = generate_radiogroup('component_method',
                                                            [{value:'connected_components',label:'Connected Components',checked:true},
                                                             {value:'modularity',label:'Modularity'},
                                                             {value:'async_label_prop',label:'Async Label Propagation'},
                                                             {value:'label_prop',label:'Label Propagation'},
                                                             {value:'centrality',label:'Centrality'}],
                                                            'load_mog()', 200)
                                    document.write(component_rg.getHTML())
                                </script>
                                </div>

                                Connectivity Method
                                <div class="d-inline-block align-middle" style="text-align: center;">
                                <script>
                                    let link_rg = generate_radiogroup('link_method',[{value:'connectivity',label:'Connectivity',checked:true}],'load_mog()', 200)
                                    document.write(link_rg.getHTML())
                                </script>
                                </div>

                                Mapper Graph Filtering
                                <div class="d-inline-block align-middle" style="text-align: center;">
                                <script>
                                    let lcc_cg = generate_checkbox('gcc_only','Largest Connected Component Only','load_mog()', 200)
                                    document.write(lcc_cg.getHTML())
                                </script>
                                </div>

                                <div class="form-group">
                                    <label for="mapper_node_size_filter">Mapper Node Size Filter: <span
                                            id="mapper_node_size_filter_value">0</span></label>
                                    <input type="range" class="custom-range" min="0" max="20" step="1" value="0"
                                           id="mapper_node_size_filter" name="mapper_node_size_filter"
                                           onchange="load_mog(); document.getElementById('mapper_node_size_filter_value').innerHTML = document.getElementById('mapper_node_size_filter').value;">
                                </div>
            </div>


        </form>

        <!-- img src="static/img/viridis.png" width="100%" height="20" -->
    </div>

    <div class="page-content" id="visualization" style="white-space: nowrap;">
        <div style="text-align: left; width: 1200px;">
            <div id="mog_row_agd">
                <p class="row_title" id="row1_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/GnBu.png">
                    Average Geodesic Distance
                </p>
                <svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_agd_A"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_agd_B"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_agd_C"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_agd_D"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_agd_E"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_agd_F"></svg>
            </div>
            <div id="mog_row_den_0_5">
                <p class="row_title" id="row2_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/Oranges.png">
                    Density (0.5)
                </p>
                <svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_den_0_5_A"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_den_0_5_B"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_den_0_5_C"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_den_0_5_D"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_den_0_5_E"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_den_0_5_F"></svg>
            </div>
            <div id="mog_row_ecc">
                <p class="row_title" id="row3_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/BuGn.png">
                    Eccentricity
                </p>
                <svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_ecc_A"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_ecc_B"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_ecc_C"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_ecc_D"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_ecc_E"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_ecc_F"></svg>
            </div>
            <div id="mog_row_fv">
                <p class="row_title" id="row4_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/BuPu.png">
                    Fiedler Vector
                </p>
                <svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_A"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_B"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_C"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_D"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_E"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_F"></svg>
            </div>
            <div id="mog_row_fv_norm">
                <p class="row_title" id="row5_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/BuPu.png">
                    Fiedler Vector Normalized
                </p>
                <svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_norm_A"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_norm_B"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_norm_C"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_norm_D"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_norm_E"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_fv_norm_F"></svg>
            </div>
            <div id="mog_row_pr_0_85">
                <p class="row_title" id="row5_title">
                    <img width=100 height=16 style="padding-bottom: 3px; padding-right: 5px;" src="img/YlOrRd.png">
                    PageRank (alpha=0.85)
                </p>
                <svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_pr_0_85_A"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_pr_0_85_B"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_pr_0_85_C"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_pr_0_85_D"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_pr_0_85_E"></svg><svg height="200" width="200" style="border-style: solid; border-width: 1px;" id="mog_vis_pr_0_85_F"></svg>
            </div>
        </div>
    </div>
</div>


<script>





    let mogs = [];


    let MOG_Vis = function( svg_name, options, ff ){
        let param_uri = $.param(options)
        let mog_data = null
        let mog_vis = null

        function send_to_cache(){
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "mog_cache?"+param_uri, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            tmp_data = {'nodes':mog_data.nodes,'links':[]};
            mog_data.links.forEach( function(L){
               tmp_data.links.push({'value':L.value,'source':L.source.id,'target':L.target.id});
            });
            xhr.send(JSON.stringify(tmp_data));
        }

        d3.json("mog?" + param_uri, function (error, data) {
            if (error) {
                console.log(error);
            } else {
                mog_data = data
                mog_vis = FDL_Graph_Vis(svg_name, mog_data);
                mog_vis.update_node_radius(d => Math.min( Math.sqrt(d.component_count), 20));
                mog_vis.update_node_color(colorSchemes[ff],n=>n.avg_value);
                mog_vis.update_link_width(d => Math.min( Math.sqrt(d.value), 20)/2 );
                mog_vis.add_count_labels();
                mog_vis.set_end_callback( ()=>send_to_cache() );
            }
        });

        return {
            remove : function(){
                if( mog_vis ) mog_vis.remove();
            }
        }

    }

    function update_mog( svg_name, options, ff ) {
        mogs.push( MOG_Vis(svg_name,options,ff) )
        /*
        let param_uri = $.param(options)
        //console.log(param_uri)
        d3.json("mog?" + param_uri, function (error, data) {
            if (error) {
                console.log(error);
            } else {
                mog_vis = FDL_Graph_Vis(svg_name, data);
                mog_vis.update_node_radius(d => Math.min( Math.sqrt(d.component_count), 20));
                mog_vis.update_node_color(colorSchemes[ff],n=>n.avg_value);
                mog_vis.update_link_width(d => Math.min( Math.sqrt(d.value), 20)/2 );
                mog_vis.add_count_labels();
                mog_vis.set_end_callback( function(){ mog_vis.send_to_url("mog_cache?"+param_uri) } );
                mogs.push(mog_vis)

                //setTimeout( function(){ mog_vis.zoomFit(0.95,1000) }, 2000);
                //setTimeout( function(){ mog_vis.send_to_url("mog_cache?"+param_uri) }, 5000);
            }
        });
         */

    }

    function change_dataset() {
        update_datafiles();
        change_datafile();
    }

    function load_mog(){
        letters = ['A','B','C','D','E','F'];

        mogs.forEach( M=>M.remove() );
        mogs = []

        let ds = get_selected_dataset();
        let df = get_selected_datafile();

        let possible_ff = ['agd','den_0_5','ecc','fv', 'fv_norm','pr_0_85']
        possible_ff.forEach( ff=>{
            document.getElementById("mog_row_"+ff).style.display = "none"
        })

        ff = []
        if( 'agd' in datasets[ds][df]) ff.push('agd')
        if( 'den_0_5' in datasets[ds][df]) ff.push('den_0_5')
        if( 'ecc' in datasets[ds][df]) ff.push('ecc')
        if( 'fv' in datasets[ds][df]) ff.push('fv')
        else if( 'fv_norm' in datasets[ds][df]) ff.push('fv_norm')
        if( 'pr_0_85' in datasets[ds][df]) ff.push('pr_0_85')

        ff.forEach( cur_ff=>{

            document.getElementById("mog_row_"+cur_ff).style.display = "block"

            for (let j = 0; j < 6; j ++) {
                coverN = 2 + 4*j;
                let options = {
                    'dataset': ds,
                    'datafile': df,
                    'filter_func': cur_ff,
                    'coverN': coverN,
                    'rank_filter':  rank_cg.isChecked(),
                    'coverOverlap': 0,
                    'component_method': component_rg.getSelected(),
                    'link_method': link_rg.getSelected(),
                    'gcc_only':  lcc_cg.isChecked(),
                    'mapper_node_size_filter': get_selected_value('mapper_node_size_filter')
                }
                update_mog("#mog_vis_"+cur_ff+"_"+letters[j], options, cur_ff )

            }
        })

    }

    function change_datafile() {
        load_mog();
    }

    load_datasets(change_datafile);

</script>

<div id="overlay" onclick="overlay_off()"></div>

<script>
function overlay_on() {
  document.getElementById("overlay").style.display = "block";
}

function overlay_off() {
  document.getElementById("overlay").style.display = "none";
}
</script>

</body>
</html>


<!doctype html>
<html lang="en">
<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">

    <!-- Icon -->
    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Mapper on Graphs</title>

    <script src="https://d3js.org/d3.v4.min.js"
            integrity="sha384-1EOYqz4UgZkewWm70NbT1JBUXSQpOIS2AaJy6/evZH+lXOrt9ITSJbFctNeyBoIJ"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"
            integrity="sha384-hX5odjoulJel81+3dsnorXlZ7kA46f8qrV+2sBCcEAXaCyEAiRusFRjaefWw2NPp"
            crossorigin="anonymous"></script>

    <script src="js/menu.js"></script>
    <script src="js/graph.js"></script>
    <script src="js/histogram.js"></script>
    <script src="js/draggable_box.js"></script>
    <script src="js/dataDownload.js"></script>
    <script src="js/cover.js"></script>
    <script src="js/common.js"></script>

</head>
<body>

<script>
	insert_navbar("very_large.html");
    insert_page_header();
</script>



<div class="page">
    <div class="sidebar">
        <h2>Mapper on Graphs</h2>
        <form id="parameterForm">
            <div class="container" style="padding: 0;">
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="dataset" style="margin-top: 3px;">Data Set</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="dataset" name="dataset"
                                onchange="change_dataset();"></select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="datafile" style="margin-top: 3px;">Data File</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="datafile" name="datafile"
                                onchange="change_datafile();"></select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4" style="padding-right: 3px;">
                        <label for="filter_func" style="margin-top: 3px;">Filter Function</label>
                    </div>
                    <div class="col-8" style="padding-right: 3px;">
                        <select class="form-control form-control-sm" id="filter_func" name="filter_func"
                                onchange="change_filter_func();"></select>
                    </div>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="true" id="rank_filter" name="rank_filter"
                           onchange="change_filter_func();">
                    <label class="form-check-label" for="rank_filter">
                        Rank Filter Values?
                    </label>
                </div>
            </div>


            <div class="accordion" id="accordionExample">
                <div class="card">
                    <div class="card-header" id="headingOne">
                        <h5 class="mb-0">
                            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne"
                                    aria-expanded="true" aria-controls="collapseOne">
                                Cover Parameters
                            </button>
                        </h5>
                    </div>

                    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne"
                         data-parent="#accordionExample">
                        <div class="card-body">
                            <div class="form-group">
                                <label for="coverN">Cover Elements: <span id="coverN_value">2</span></label>
                                <input type="range" class="custom-range" min="2" max="20" step="1" value="2" id="coverN"
                                       name="coverN"
                                       onchange="change_cover(); document.getElementById('coverN_value').innerHTML = document.getElementById('coverN').value;">
                            </div>
                            <div class="form-group">
                                <label for="coverOverlap">Cover Overlap: <span
                                        id="coverOverlap_value">0</span></label>
                                <input type="range" class="custom-range" min="0" max="0" step="0.01" value="0"
                                       id="coverOverlap" name="coverOverlap"
                                       onchange="change_cover(); document.getElementById('coverOverlap_value').innerHTML = document.getElementById('coverOverlap').value;">
                            </div>


                            <div class="row">
                                <div class="col-4" style="padding-right: 3px;">
                                    <label for="component_method" style="margin-top: 3px;">Component Method</label>
                                </div>
                                <div class="col-8" style="padding-right: 3px;">
                                    <select class="form-control form-control-sm" id="component_method"
                                            name="component_method" onchange="change_cover();">
                                        <option value="connected_components" selected>Connected Components</option>
                                        <option value="modularity">Modularity</option>
                                        <option value="async_label_prop">Async Label Propagation</option>
                                        <option value="label_prop">Label Propagation</option>
                                        <option value="centrality">Centrality</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-4" style="padding-right: 3px;">
                                    <label for="link_method" style="margin-top: 3px;">Connectivity Method</label>
                                </div>
                                <div class="col-8" style="padding-right: 3px;">
                                    <select class="form-control form-control-sm" id="link_method"
                                            name="link_method" onchange="change_cover();">
                                        <!--option value="overlap" selected>Overlap</option-->
                                        <option value="connectivity">Connectivity</option>
                                    </select>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingTwo">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                                        data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Graph Filtering
                                </button>
                            </h5>
                        </div>
                        <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo"
                             data-parent="#accordionExample">
                            <div class="card-body">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="true" id="gcc_only"
                                           name="gcc_only" onchange="change_cover();">
                                    <label class="form-check-label" for="gcc_only">
                                        Get GCC Only?
                                    </label>
                                </div>

                                <div class="form-group">
                                    <label for="mapper_node_size_filter">Mapper Node Size Filter: <span
                                            id="mapper_node_size_filter_value">0</span></label>
                                    <input type="range" class="custom-range" min="0" max="20" step="1" value="0"
                                           id="mapper_node_size_filter" name="mapper_node_size_filter"
                                           onchange="change_cover(); document.getElementById('mapper_node_size_filter_value').innerHTML = document.getElementById('mapper_node_size_filter').value;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

    </div>

    <div class="page-content" id="visualization" style="white-space: nowrap;">
        <div style="text-align: center; width: 1200px;">
            <svg height="800" width="800" style="border: thick;" id="mog_vis"></svg>
            <br>
            <input type="button" id="downloadMOG" name="downloadMOG"
                   onclick="downloadJson(mog_data,'mog.json');" value="Download MOG">
        </div>
    </div>
</div>


<script>

    var seqColorScheme = d3.scaleSequential().interpolator(d3.interpolateViridis); // .domain([dmin,dmax])
    var catColorScheme = d3.scaleOrdinal().range(d3.schemeSet3); // .domain(graph.nodes, function(n){ return n['type']; } )
    // var catColorScheme = d3.scaleOrdinal( d3.schemeCategory20 );


    let mog_vis = null;
    let mog_data = null;

    let histo_vis = null;
    let cover_vis = null;

    function update_mog() {
        d3.json("mog?" + $("#parameterForm").serialize(), function (error, data) {
            if (error) {
                console.log(error);
            } else {
                mog_data = data;
                console.log(data);
                //$("#mog_vis").empty();

                col_data = {}
                mog_data.nodes.forEach( function(n){
                    col_data[n.id] = n.avg_value;
                });

                if( mog_vis ) mog_vis.remove();
                mog_vis = FDL_Graph_Vis("#mog_vis", mog_data);
                mog_vis.update_node_radius(d => Math.min( Math.sqrt(d.component_count), 20));
                mog_vis.update_node_color(col_data);
                mog_vis.update_link_width(d => Math.min( Math.sqrt(d.value), 20)/2 );
            }
        });

    }

    function change_dataset() {
        update_datafiles();
        change_datafile();
    }

    function change_datafile() {
        load_graph( change_filter_func );
    }

    function change_filter_func() {
        d3.json("filter_function?" + $("#parameterForm").serialize(), function (error, data) {
            //if( data.nodes.length < 5000 ) {
                //graph_vis.update_node_color(data);
            //}

            histo_vis.set_position( 50, 20, 80, 200 );
            histo_vis.update_drawing( 10, Object.values(data) )

            change_cover();
        });
    }

    function change_cover() {
        update_mog();
        cover_vis.set_position( 10, 20, 30, 200 );
        cover_vis.update_drawing( parseFloat(document.getElementById('coverN').value),
                                    parseFloat(document.getElementById('coverOverlap').value) );
    }


    function load_graph(callback) {
        /*
        d3.json("graph?" + $("#parameterForm").serialize(), function (error, data) {
            if (error) {
                console.log(error);
            } else {
                graph_data = data;

                $("#graph_vis").empty();
                console.log( data.nodes.length )
                //if( data.nodes.length < 5000 ) {
                    graph_vis = FDL_Graph_Vis("#graph_vis", data);
                //}
*/
                if (callback) callback();
  //          }
    //    });
    }

                    histo_vis = histogram_vis("#mog_vis");
                    cover_vis = cover_visualization("#mog_vis");

    load_datasets(change_datafile);

</script>


</body>
</html>

